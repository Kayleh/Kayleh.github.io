<!DOCTYPE html><!--[if IEMobile 7 ]><html class="no-js iem7" lang="zh-CN"><![endif]--><!--[if lt IE 9]><html class="no-js lte-ie8" lang="zh-CN"><![endif]--><!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="zh-CN"><!--<![endif]--><head><meta charset="UTF-8"><title>Java高性能高并发秒杀系统(10)</title><meta name="author" content="Kayleh"><link rel="shortcut icon" href="/images/favicon.png"><meta name="HandheldFriendly" content="True"><meta name="MobileOptimized" content="320"><meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=1"><link rel="canonical" href="https://kayleh.top/Java-high-performance-and-high-concurrency-spike-system-10/"><link rel="alternate" href="/atom.xml" type="application/atom+xml"><script src="/js/modernizr-2.0.js"></script><script src="/js/jquery-1.9.1.js"></script><script>window.twttr=function(t,e,r){var n,i=t.getElementsByTagName(e)[0],w=window.twttr||{};return t.getElementById(r)||((n=t.createElement(e)).id=r,n.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(n,i),w._e=[],w.ready=function(t){w._e.push(t)}),w}(document,"script","twitter-wjs")</script><link rel="me" href="https://twitter.com/y40jinqing"><script src="/js/octo.js"></script><link rel="stylesheet" href="/css/octo.css"><link href="https://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css"><meta name="generator" content="Hexo 4.2.0"></head><body><header role="banner"><hgroup><h1><a href="/">Kayleh</a></h1></hgroup></header><nav role="navigation"><ul class="subscription" data-subscription="rss"><li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li></ul><form action="https://google.com/search" method="get"><fieldset role="search"><input type="hidden" name="q" value="site:https://kayleh.top/"> <input class="search" type="text" name="q" results="0" placeholder="Search"></fieldset></form><ul class="main-navigation"><li><a href="/">Blog</a></li><li><a href="/archives">Archives</a></li></ul></nav><div id="main"><div id="content"><div><article class="hentry" role="article"><header><h1 class="entry-title">Java高性能高并发秒杀系统(10)</h1><p class="meta"><time datetime="2020-12-11T12:15:45.000Z" data-updated="true">Fri Dec 11 2020</time></p></header><div class="entry-content"><h2 id="1-库存预加载到Redis中是怎么实现的？"><a href="#1-库存预加载到Redis中是怎么实现的？" class="headerlink" title="1. 库存预加载到Redis中是怎么实现的？"></a>1. 库存预加载到Redis中是怎么实现的？</h2><p>我是通过实现<code>InitializingBean接口</code>，重写其中<code>afterPropertiesSet()方法</code>，实现的预加载</p><h3 id="1-1-之后主动添加秒杀商品的话，怎么添加？"><a href="#1-1-之后主动添加秒杀商品的话，怎么添加？" class="headerlink" title="1.1 之后主动添加秒杀商品的话，怎么添加？"></a>1.1 之后主动添加秒杀商品的话，怎么添加？</h3><p>通过后台管理进行添加，修改redis缓存和数据库中的值</p><hr><h2 id="2-在Redis中扣减库存的时候，是怎么保证线程安全，防止超卖的？"><a href="#2-在Redis中扣减库存的时候，是怎么保证线程安全，防止超卖的？" class="headerlink" title="2. 在Redis中扣减库存的时候，是怎么保证线程安全，防止超卖的？"></a>2. 在Redis中扣减库存的时候，是怎么保证线程安全，防止超卖的？</h2><p>redis中有一个<code>decr()</code>方法，它实现的是递减操作，而且能够<code>保证原子性</code></p><hr><h2 id="3-如果出现Redis缓存雪崩、穿透，怎么解决？"><a href="#3-如果出现Redis缓存雪崩、穿透，怎么解决？" class="headerlink" title="3. 如果出现Redis缓存雪崩、穿透，怎么解决？"></a>3. 如果出现Redis缓存雪崩、穿透，怎么解决？</h2><p>雪崩就是缓存中我存储的值全部都失效了，请求直接打到数据库上，请求过大，数据库扛不住。可以用设置这些热点数据永不失效，或者是设置一个随机的过期时间，这样来避免它同时失效。</p><p>缓存穿透是缓存和数据库中都没有的数据，如果有人利用这些数据高并发的访问的话，对数据库压力也很大。可以对数据比如它的id值进行一个校验，避免这些不存在的值对数据库进行访问或者是使用布隆过滤器，它的原理是通过高效的数据结构查询数据库中是否存在这个值，不存在的时候，就直接返回，存在的话才会访问到数据库。</p><hr><h2 id="4-限流防刷是怎么实现的？"><a href="#4-限流防刷是怎么实现的？" class="headerlink" title="4. 限流防刷是怎么实现的？"></a>4. 限流防刷是怎么实现的？</h2><p>限流防刷我是通过拦截器来实现的，我自定义了一个注解，它实现的功能就是标记在方法上，规定它单位时间内的访问次数，如果超过要求的话，就会被拦截。</p><p>拦截器我是继承的HandlerInterceptorAdapter，重写的是preHandle方法，在该方法中，将访问次数同步到Redis中，这个键值对是存在有效期的。最后还要把拦截器配置到项目中，继承WebMvcConfigurerAdapter，重写<code>addInterceptors()</code>方法</p><hr><h2 id="5-对于用户的恶意下单，他知道了你的URL地址，不停的刷，怎么办？"><a href="#5-对于用户的恶意下单，他知道了你的URL地址，不停的刷，怎么办？" class="headerlink" title="5. 对于用户的恶意下单，他知道了你的URL地址，不停的刷，怎么办？"></a>5. 对于用户的恶意下单，他知道了你的URL地址，不停的刷，怎么办？</h2><p>我是通过隐藏URL地址来避免这种问题的，当访问秒杀接口的时候，会先从后端生成一个随机的字符串，然后保存到redis中，并且拼接到URL地址上，这样再去访问秒杀的接口，通过RestFul风格的地址，获取其中的随机字符串，与redis中的进行比对，一致的话，才能继续向下访问</p><hr><h2 id="6-秒杀成功后是怎么同步到数据库中的？"><a href="#6-秒杀成功后是怎么同步到数据库中的？" class="headerlink" title="6. 秒杀成功后是怎么同步到数据库中的？"></a>6. 秒杀成功后是怎么同步到数据库中的？</h2><p>通过两步，一步是减少商品库存，第二步是创建秒杀订单。</p><h3 id="6-1-减库存成功，创建秒杀订单失败了怎么办？"><a href="#6-1-减库存成功，创建秒杀订单失败了怎么办？" class="headerlink" title="6.1 减库存成功，创建秒杀订单失败了怎么办？"></a>6.1 减库存成功，创建秒杀订单失败了怎么办？</h3><p>这两步过程在一个事务中执行，然后先减少库存，它有一个成功的标志，减少库存成功了，才去执行创建订单的操作</p><h3 id="6-2-Spring默认的事务隔离级别"><a href="#6-2-Spring默认的事务隔离级别" class="headerlink" title="6.2 Spring默认的事务隔离级别"></a>6.2 Spring默认的事务隔离级别</h3><p>默认情况下Spring使用的是数据库设置的默认隔离级别，应该是<code>可重复读</code></p><hr><h2 id="7-RabbitMQ怎么提高消息的高可用？"><a href="#7-RabbitMQ怎么提高消息的高可用？" class="headerlink" title="7. RabbitMQ怎么提高消息的高可用？"></a>7. RabbitMQ怎么提高消息的高可用？</h2><p>我在创建队列实例的时候，将其创建为可持久化的，它有一个durable属性设置为true，这样，RabbitMQ服务重启的情况下，也不会丢失消息。</p><hr><h2 id="8-说说volatile关键字儿"><a href="#8-说说volatile关键字儿" class="headerlink" title="8. 说说volatile关键字儿"></a>8. 说说volatile关键字儿</h2><p>它最重要的一点就是保证了变量的可见性。我想先说说JMM（java内存模型），每个线程有自己的工作内存，另外还存在一个主内存，线程从主内存中获取值存储在自己的工作内存中，当对变量进行修改，它不会立即将其同步到主内中，这个时候若有其他线程来从主内存中获取该变量的时候，就会发生脏读的现象，若被volatile标记的话，就能保证变量的可见性，当变量被修改的时候他就会将其立即同步到主内存中。</p><hr><h2 id="9-TCP和UDP的区别"><a href="#9-TCP和UDP的区别" class="headerlink" title="9. TCP和UDP的区别"></a>9. TCP和UDP的区别</h2><ol><li>TCP是需要通过三次握手建立连接的；UDP是无连接的</li><li>TCP提供的可靠性高；UDP的不保证可靠性，一般用于直播或者是语音通话</li><li>TCP是基于字节流的传输层协议，它比较慢；UDP比较快</li></ol><hr><h2 id="10-ArrayList"><a href="#10-ArrayList" class="headerlink" title="10. ArrayList"></a>10. ArrayList</h2><ul><li>底层是数组，查询快，增删慢</li><li>它的默认大小是10，添加值的时候会先对当前数组大小和总大小进行判断，若出现超过最大容量的话，就要进行扩容，扩容的大小是原来大小的1.5倍（右移运算符，右移1位），再将之前的数据复制到新的数组里边。</li></ul></div><footer><p class="meta"><span class="byline author vcard">Posted by <span class="fn">Kayleh</span></span> <time datetime="2020-12-11T12:15:45.000Z" data-updated="true">Fri Dec 11 2020</time> <span class="categories"><a class="category" href="/tags/project/">project</a></span></p><div class="sharing"><a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Java%E9%AB%98%E6%80%A7%E8%83%BD%E9%AB%98%E5%B9%B6%E5%8F%91%E7%A7%92%E6%9D%80%E7%B3%BB%E7%BB%9F(10)" target="_blank" rel="noopener">Tweet</a></div><p class="meta"><a class="basic-alignment left" href="/JVM-classloader-and-parent-delegation-mechanism/index.html" title="Previous Post: JVM-类加载器和双亲委派机制">« JVM-类加载器和双亲委派机制</a> <a class="basic-alignment right" href="/Java-high-performance-and-high-concurrency-spike-system-9/index.html" title="Previous Post: Java高性能高并发秒杀系统(9)">Java高性能高并发秒杀系统(9) »</a></p></footer></article><section><h1>Comments</h1><div id="disqus_thread"></div><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript><script>var canonicalUrl="https://kayleh.top/Java-high-performance-and-high-concurrency-spike-system-10/",disqus_config=function(){this.page.url=canonicalUrl,this.page.identifier=canonicalUrl};!function(){var e=document,a=e.createElement("script");a.src="https://kayleh.disqus.com/embed.js",a.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(a)}()</script></section></div><aside class="sidebar"><section class="odd"><h1>Recent Posts</h1><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/program-test/">软件测试流程</a></li><li class="post-list-item"><a class="post-list-link" href="/SpringBoot-startup-process/">SpringBoot启动过程</a></li><li class="post-list-item"><a class="post-list-link" href="/bionioaio/">BIO、NIO、AIO区别</a></li><li class="post-list-item"><a class="post-list-link" href="/IO/">浅谈IO</a></li><li class="post-list-item"><a class="post-list-link" href="/off-heap/">堆外内存</a></li><li class="post-list-item"><a class="post-list-link" href="/single-point-login/">单点登录实现</a></li><li class="post-list-item"><a class="post-list-link" href="/jmm-memory-model/">JMM内存模型</a></li><li class="post-list-item"><a class="post-list-link" href="/jvm-gc/">JVM垃圾回收机制</a></li><li class="post-list-item"><a class="post-list-link" href="/springmvc-work-stream/">SpringMVC工作流程</a></li><li class="post-list-item"><a class="post-list-link" href="/null/">事务的隔离级别</a></li></ul></section><section class="even"><h1>GitHub Repos</h1><ul id="gh_repos"><li class="loading">Status updating&#8230;</li></ul><a href="https://github.com/kayleh" target="_blank" rel="noopener">@kayleh</a> on GitHub<script>$(document).ready(function(){
            const options = {
                user: 'kayleh',
                count: 0,
                skip_forks: true,
                target: '#gh_repos'
            }

            function escapeHtml(str) {
                return $('<div/>').text(str).html();
            }

            function render(target, repos){
                let i, fragment = '', t = $(target)[0];

                for(i = 0; i < repos.length; i++) {
                    fragment += '<li><a href="'+repos[i].html_url+'">'+repos[i].name+'</a><p>'+escapeHtml(repos[i].description||'')+'</p></li>';
                }
                t.innerHTML = fragment;
            }

            $.ajax({
                url: "https://api.github.com/users/"+options.user+"/repos?sort=pushed&callback=?",
                dataType: 'jsonp',
                error: function (err) {
                    $(options.target + ' li.loading').addClass('error').text("Error loading feed");
                },
                success: function(data) {
                    var repos = [];
                    if (!data || !data.data) { return; }
                    for (var i = 0; i < data.data.length; i++) {
                        if (options.skip_forks && data.data[i].fork) { continue; }
                        repos.push(data.data[i]);
                    }
                    if (options.count) { repos.splice(options.count); }
                    render(options.target, repos);
                }
            });
        });</script></section></aside></div></div><footer role="contentinfo"><p>Copyright © 2021 - Kayleh - <span class="credit">Generated using <a href="https://github.com/jbreckmckye/hexo-theme-octo" target="_blank" rel="noopener">Octo theme</a> for <a href="http://hexo.io" target="_blank" rel="noopener">Hexo</a></span></p></footer></body></html>