<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>SpringSecurity | Kayleh</title><meta name="description" content="SpringBootæ•´åˆSpringSecurity https:&#x2F;&#x2F;www.kuangstudy.com&#x2F;bbs&#x2F;1369251751735095298  Spring Securityè¯¾ç¨‹ä»‹ç»1. æ¡†æ¶æ¦‚è¿°ğŸ“• Spring Securityæ˜¯åŸºäºSpringæ¡†æ¶,æä¾›äº†ä¸€å¥—Webåº”ç”¨å®‰å…¨æ€§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æ­£å¦‚ä½ å¯èƒ½çŸ¥é“çš„å…³äºå®‰å…¨æ–¹é¢çš„ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯â€è®¤è¯â€å’Œâ€æˆæƒâ€(æˆ–è€…è®¿é—®æ§åˆ¶),ä¸€èˆ¬æ¥è¯´"><meta name="author" content="Kayleh"><meta name="copyright" content="Kayleh"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/favicon.png"><link rel="canonical" href="https://kayleh.top/SpringSecurity/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="preconnect" href="//zz.bdstatic.com"><meta name="google-site-verification" content="LQn0xwjfEU_V6CXCA0qAdwM4qRXtblIbfy5KuzEKaRg"><meta property="og:type" content="article"><meta property="og:title" content="SpringSecurity"><meta property="og:url" content="https://kayleh.top/SpringSecurity/"><meta property="og:site_name" content="Kayleh"><meta property="og:description" content="SpringBootæ•´åˆSpringSecurity https:&#x2F;&#x2F;www.kuangstudy.com&#x2F;bbs&#x2F;1369251751735095298  Spring Securityè¯¾ç¨‹ä»‹ç»1. æ¡†æ¶æ¦‚è¿°ğŸ“• Spring Securityæ˜¯åŸºäºSpringæ¡†æ¶,æä¾›äº†ä¸€å¥—Webåº”ç”¨å®‰å…¨æ€§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æ­£å¦‚ä½ å¯èƒ½çŸ¥é“çš„å…³äºå®‰å…¨æ–¹é¢çš„ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯â€è®¤è¯â€å’Œâ€æˆæƒâ€(æˆ–è€…è®¿é—®æ§åˆ¶),ä¸€èˆ¬æ¥è¯´"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/index4.jpg"><meta property="article:published_time" content="2021-05-20T19:56:08.000Z"><meta property="article:modified_time" content="2021-05-24T03:01:04.772Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = '1'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle=window.adsbygoogle||[]).push({google_ad_client:"ca-pub-7457165067653912",enable_page_level_ads:"true"})</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?24f5d46da7ff42ae73ccea4ea7114e1b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG={root:"/",hexoversion:"4.2.0",algolia:void 0,localSearch:void 0,translate:void 0,noticeOutdate:{limitDay:10,position:"top",messagePrev:"It has been",messageNext:"days since the last update, the content of the article may be outdated."},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},bookmark:{message_prev:"æŒ‰",message_next:"é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾"},runtime_unit:"å¤©",runtime:!1,copyright:void 0,ClickShowText:void 0,medium_zoom:!0,fancybox:!1,Snackbar:void 0,justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js",css:"https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css"},baiduPush:!0,highlightCopy:!0,highlightLang:!0,isPhotoFigcaption:!1,islazyload:!0,isanchor:!0}</script><script id="config_change">var GLOBAL_CONFIG_SITE={isPost:!0,isHome:!1,isHighlightShrink:!1,isSidebar:!0,postUpdate:"2021-05-24 11:01:04"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}</style></noscript><meta http-equiv="Content-Type" content="text/html;charset=gb2312"><meta name="sogou_site_verification" content="7uatD8cGg5"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="Kayleh" type="application/atom+xml"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/2.jpg" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">190</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">6</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="https://home.kayleh.top/" target="_blank" rel="noopener"><i class="fa-fw fa fa-reply"></i><span> return</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="https://shell.kayleh.top/" target="_blank" rel="noopener"><i class="fa-fw fa fa-bolt"></i><span> shell</span></a></div><div class="menus_item"><a class="site-page" href="/en"><i class="fa-fw fa fa-info-circle"></i><span> English</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-id-card"></i><span> æˆ‘?</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹äººå¸</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-folder-open"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="mailto:kaylehisdied@gmail.com"><i class="fa-fw fa fa-envelope"></i><span> mail</span></a></li><li><a class="site-page" href="/2020/06/11/RESUME/"><i class="fa-fw fa fa-envelope-open"></i><span> resume</span></a></li></ul></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBootæ•´åˆSpringSecurity"><span class="toc-text">SpringBootæ•´åˆSpringSecurity</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Securityè¯¾ç¨‹ä»‹ç»"><span class="toc-text">Spring Securityè¯¾ç¨‹ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-æ¡†æ¶æ¦‚è¿°"><span class="toc-text">1. æ¡†æ¶æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-å…¥é—¨æ¡ˆä¾‹"><span class="toc-text">2. å…¥é—¨æ¡ˆä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-SpringSecurityåŸºæœ¬åŸç†"><span class="toc-text">3. SpringSecurityåŸºæœ¬åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-ç”¨æˆ·è®¤è¯"><span class="toc-text">4. ç”¨æˆ·è®¤è¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢"><span class="toc-text">5. è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-ç”¨æˆ·æˆæƒ-åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶"><span class="toc-text">6. ç”¨æˆ·æˆæƒ(åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-hasAuthority-æ–¹æ³•"><span class="toc-text">6.1 hasAuthority æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-hasAnyAuthority-æ–¹æ³•"><span class="toc-text">6.2 hasAnyAuthority æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-hasRole-æ–¹æ³•"><span class="toc-text">6.3 hasRole æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-hasAnyRole-æ–¹æ³•"><span class="toc-text">6.4 hasAnyRole æ–¹æ³•</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-ç”¨æˆ·æˆæƒ-è‡ªå®šä¹‰403é¡µé¢"><span class="toc-text">7. ç”¨æˆ·æˆæƒ(è‡ªå®šä¹‰403é¡µé¢)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-ç”¨æˆ·æˆæƒ-æ³¨è§£ä½¿ç”¨"><span class="toc-text">8. ç”¨æˆ·æˆæƒ(æ³¨è§£ä½¿ç”¨)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-Secured"><span class="toc-text">8.1 @Secured</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-PreAuthorize"><span class="toc-text">8.2 @PreAuthorize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-PostAuthorize"><span class="toc-text">8.3 @PostAuthorize</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-4-PostFilter"><span class="toc-text">8.4 @PostFilter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-PreFilter"><span class="toc-text">8.5 @PreFilter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-ç”¨æˆ·æ³¨é”€"><span class="toc-text">9. ç”¨æˆ·æ³¨é”€</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-è‡ªåŠ¨ç™»å½•"><span class="toc-text">10. è‡ªåŠ¨ç™»å½•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-CSRFåŠŸèƒ½"><span class="toc-text">11. CSRFåŠŸèƒ½</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image:url(https://cdn.jsdelivr.net/gh/kayleh/cdn/img/index4.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Kayleh</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="https://home.kayleh.top/" target="_blank" rel="noopener"><i class="fa-fw fa fa-reply"></i><span> return</span></a></div><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="https://shell.kayleh.top/" target="_blank" rel="noopener"><i class="fa-fw fa fa-bolt"></i><span> shell</span></a></div><div class="menus_item"><a class="site-page" href="/en"><i class="fa-fw fa fa-info-circle"></i><span> English</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> å½’æ¡£</span></a></div><div class="menus_item"><a class="site-page" href="/about"><i class="fa-fw fa fa-id-card"></i><span> æˆ‘?</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> å‹äººå¸</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-folder-open"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="mailto:kaylehisdied@gmail.com"><i class="fa-fw fa fa-envelope"></i><span> mail</span></a></li><li><a class="site-page" href="/2020/06/11/RESUME/"><i class="fa-fw fa fa-envelope-open"></i><span> resume</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">SpringSecurity</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-05-20T19:56:08.000Z" title="å‘è¡¨äº 2021-05-21 03:56:08">2021-05-21</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2021-05-24T03:01:04.772Z" title="æ›´æ–°äº 2021-05-24 11:01:04">2021-05-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">2.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>11åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="SpringBootæ•´åˆSpringSecurity"><a href="#SpringBootæ•´åˆSpringSecurity" class="headerlink" title="SpringBootæ•´åˆSpringSecurity"></a>SpringBootæ•´åˆSpringSecurity</h1><blockquote><p><a href="https://www.kuangstudy.com/bbs/1369251751735095298" target="_blank" rel="noopener">https://www.kuangstudy.com/bbs/1369251751735095298</a></p></blockquote><h2 id="Spring-Securityè¯¾ç¨‹ä»‹ç»"><a href="#Spring-Securityè¯¾ç¨‹ä»‹ç»" class="headerlink" title="Spring Securityè¯¾ç¨‹ä»‹ç»"></a>Spring Securityè¯¾ç¨‹ä»‹ç»</h2><h3 id="1-æ¡†æ¶æ¦‚è¿°"><a href="#1-æ¡†æ¶æ¦‚è¿°" class="headerlink" title="1. æ¡†æ¶æ¦‚è¿°"></a>1. æ¡†æ¶æ¦‚è¿°</h3><p>ğŸ“• Spring Securityæ˜¯åŸºäºSpringæ¡†æ¶,æä¾›äº†ä¸€å¥—Webåº”ç”¨å®‰å…¨æ€§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æ­£å¦‚ä½ å¯èƒ½çŸ¥é“çš„å…³äºå®‰å…¨æ–¹é¢çš„ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯â€è®¤è¯â€å’Œâ€æˆæƒâ€(æˆ–è€…è®¿é—®æ§åˆ¶),ä¸€èˆ¬æ¥è¯´ï¼ŒWebåº”ç”¨çš„å®‰å…¨æ€§ä¸»è¦åŒ…æ‹¬ç”¨æˆ·è®¤è¯å’Œç”¨æˆ·æˆæƒä¸¤ä¸ªéƒ¨åˆ†,è¿™ä¸¤ç‚¹ä¹Ÿæ˜¯Spring Securityçš„é‡è¦æ ¸å¿ƒåŠŸèƒ½ã€‚</p><ol><li>ç”¨æˆ·è®¤è¯æŒ‡çš„æ˜¯ : éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦ä¸ºç³»ç»Ÿä¸­çš„åˆæ³•ä¸»ä½“,ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·èƒ½å¦è®¿é—®è¯¥ç³»ç»Ÿã€‚ç”¨æˆ·è®¤è¯ä¸€èˆ¬è¦æ±‚ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚ç³»ç»Ÿé€šè¿‡æ ¡éªŒç”¨æˆ·åå’Œå¯†ç æ¥å®Œæˆè®¤è¯è¿‡ç¨‹ã€‚<strong>==é€šä¿—ç‚¹è¯´å°±æ˜¯ç³»ç»Ÿè®¤ä¸ºç”¨æˆ·æ˜¯å¦èƒ½ç™»å½•ã€‚==</strong></li><li>ç”¨æˆ·æˆæƒæŒ‡çš„æ˜¯ : éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚åœ¨åŒä¸€ç³»ç»Ÿä¸­ï¼Œä¸åŒç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚å¯¹ä¸€ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œæœ‰çš„ç”¨æˆ·åªèƒ½è¿›è¡Œè¯»å–ï¼Œè€Œæœ‰çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç³»ç»Ÿä¼šä¸ºä¸åŒçš„ç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œè€Œæ¯ä¸ªè§’è‰²å¯¹åº”ä¸€ç³»åˆ—çš„æƒé™ã€‚<strong>==é€šä¿—ç‚¹å°±æ˜¯ç³»ç»Ÿåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å»åšæŸäº›äº‹æƒ…ã€‚==</strong></li></ol><p>ğŸ“• Spring Security ç‰¹ç‚¹ :</p><ul><li>å’ŒSpringæ— ç¼æ•´åˆã€‚</li><li>å…¨é¢çš„æƒé™æ§åˆ¶</li><li>ä¸“é—¨ä¸ºWebå¼€å‘è€Œè®¾è®¡<ul><li>æ—§ç‰ˆæœ¬ä¸èƒ½è„±ç¦»Webç¯å¢ƒä½¿ç”¨</li><li>æ–°ç‰ˆæœ¬å¯¹æ•´ä¸ªæ¡†æ¶è¿›è¡Œäº†åˆ†å±‚æŠ½å–ï¼Œåˆ†æˆäº†æ ¸å¿ƒæ¨¡å—å’ŒWebæ¨¡å—,å•ç‹¬å¼•å…¥æ ¸å¿ƒæ¨¡å—å°±å¯ä»¥è„±ç¦»Webç¯å¢ƒã€‚</li></ul></li><li>é‡é‡çº§ã€‚</li></ul><h3 id="2-å…¥é—¨æ¡ˆä¾‹"><a href="#2-å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="2. å…¥é—¨æ¡ˆä¾‹"></a>2. å…¥é—¨æ¡ˆä¾‹</h3><ol><li><p>åˆ›å»ºSpringBootå·¥ç¨‹,å¼•å…¥ç›¸å…³ä¾èµ–</p><pre class="line-numbers language-lang-xml"><code class="language-lang-xml"><parent>
        <groupid>org.springframework.boot</groupid>
        <artifactid>spring-boot-starter-parent</artifactid>
        <version>2.2.1.RELEASE</version>
        <relativepath>
    </parent>
    <dependencies>
        
        <dependency>
            <groupid>org.springframework.boot</groupid>
            <artifactid>spring-boot-starter-web</artifactid>
        </dependency>
        
        <dependency>
            <groupid>org.springframework.boot</groupid>
            <artifactid>spring-boot-starter-security</artifactid>
        </dependency>
    </dependencies>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç¼–å†™Controllerè¿›è¡Œæµ‹è¯•</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RestController
public class TestController {
    @GetMapping("/add")
    public String add() {
        return "hello Security";
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="3-SpringSecurityåŸºæœ¬åŸç†"><a href="#3-SpringSecurityåŸºæœ¬åŸç†" class="headerlink" title="3. SpringSecurityåŸºæœ¬åŸç†"></a>3. SpringSecurityåŸºæœ¬åŸç†</h3><p>ğŸŒ³ <strong>Spring Security æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾</strong></p><ul><li>FilterSecurityInterceptor : æ˜¯ä¸€ä¸ªæ–¹æ³•çº§çš„æƒé™è¿‡æ»¤å™¨,åŸºæœ¬ä½äºè¿‡æ»¤é“¾çš„æœ€åº•éƒ¨</li><li>ExceptionTranslationFilter : æ˜¯ä¸€ä¸ªå¼‚å¸¸è¿‡æ»¤å™¨,ç”¨æ¥å¤„ç†åœ¨è®¤è¯æˆæƒè¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸</li><li>UsernamePassowrdAuthenticationFilter : å¯¹/loginçš„postè¯·æ±‚åšæ‹¦æˆª,æ ¡éªŒè¡¨å•ä¸­ç”¨æˆ·åå’Œå¯†ç ã€‚</li></ul><p>ğŸŒ³ è¿‡æ»¤å™¨æ˜¯å¦‚ä½•è¿›è¡ŒåŠ è½½çš„ï¼Ÿ</p><p><img src="/img/loading.gif" data-lazy-src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoverikcLoveimage-20210206021008467.png" alt="image-20210206021008467"></p><p>ğŸŒ³ ä¸¤ä¸ªé‡è¦çš„æ¥å£</p><p>âšª UserDetailsServiceæ¥å£è¯¦è§£</p><p>å½“ä»€ä¹ˆä¹Ÿæ²¡æœ‰é…ç½®çš„æ—¶å€™,è´¦å·å’Œå¯†ç æ˜¯ç”±SpringSecurityå®šä¹‰ç”Ÿæˆçš„ã€‚è€Œåœ¨å®é™…é¡¹ç›®ä¸­è´¦å·å’Œå¯†ç éƒ½æ˜¯ä»æ•°æ®åº“ä¸­æŸ¥å‡ºæ¥çš„,æ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡è‡ªå®šä¹‰é€»è¾‘æ§åˆ¶è®¤è¯é€»è¾‘ã€‚<strong>==é€šä¿—ç‚¹æ¥è¯´å°±æ˜¯æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç çš„è¿‡ç¨‹==</strong> å¦‚éœ€è¦è‡ªå®šä¹‰é€»è¾‘æ—¶,åªéœ€è¦å®ç°UserDetailsServiceæ¥å£å³å¯ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ :</p><p><img src="/img/loading.gif" data-lazy-src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoveimage-20210206022109352.png" alt="image-20210206022109352"></p><p>è¿”å›å€¼ UserDetails</p><p>è¿™ä¸ªç±»æ˜¯ç³»ç»Ÿé»˜è®¤çš„ç”¨æˆ·ä¸»ä½“</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">// è¡¨ç¤ºè·å–ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰æƒé™
Collection<? extends GrantedAuthority> getAuthorities();
// è¡¨ç¤ºè·å–å¯†ç 
String getPassword();
// è¡¨ç¤ºè·å–ç”¨æˆ·å
String getUsername();
// è¡¨ç¤ºåˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¢«é”å®š
boolean isAccountNonLocked();
// è¡¨ç¤ºå‡­è¯{å¯†ç }æ˜¯å¦è¿‡æœŸ
boolean isCredentialsNonExpired();
// è¡¨ç¤ºå½“å‰ç”¨æˆ·åæ˜¯å¦å¯ç”¨
boolean isEnabled();
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/img/loading.gif" data-lazy-src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoverikcLoveimage-20210206023136065.png" alt="image-20210206023135919"></p><p>âšª PasswordEncoder æ¥å£è®²è§£</p><p>æ•°æ®åŠ å¯†çš„æ¥å£,ç”¨äºè¿”å›Userå¯¹è±¡é‡Œé¢å¯†ç åŠ å¯†</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">// è¡¨ç¤ºæŠŠå‚æ•°æŒ‰ç…§ç‰¹å®šçš„è§£æè§„åˆ™è¿›è¡Œè§£æ
String encode(CharSequence rawPassword);
// è¡¨ç¤ºéªŒè¯ä»å­˜å‚¨ä¸­è·å–çš„ç¼–ç å¯†ç ä¸ç¼–ç åæäº¤çš„åŸå§‹å¯†ç æ˜¯å¦åŒ¹é…ã€‚å¦‚æœå¯†ç åŒ¹é…,åˆ™è¿”å›true;å¦‚æœä¸åŒ¹é…,åˆ™è¿”å›falseã€‚ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºéœ€è¦è¢«è§£æçš„å¯†ç ã€‚ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå­˜å‚¨çš„å¯†ç ã€‚
boolean matches(CharSequence rawPassowrd,String encodePassword);
// è¡¨ç¤ºå¦‚æœè§£æçš„å¯†ç èƒ½å¤Ÿå†æ¬¡è¿›è¡Œè§£æä¸”è¾¾åˆ°æ›´å®‰å…¨çš„ç»“æœåˆ™è¿”å›true,å¦åˆ™è¿”å›falseã€‚é»˜è®¤è¿”å›false
default boolean upgradeEncoding(String encodePassowrd);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>âšª BCryptPasswordEncoder</p><p>BCryptPasswordEncoderæ˜¯Spring Securityå®˜æ–¹æ¨èçš„å¯†ç è§£æå™¨,å¹³æ—¶å¤šä½¿ç”¨è¿™ä¸ªè§£æå™¨</p><p>BCryptPasswordEncoderæ˜¯å¯¹bcryptå¼ºæ•£åˆ—æ–¹æ³•çš„å…·ä½“å®ç°ã€‚æ˜¯åŸºäºHashç®—æ³•å®ç°çš„å•å‘åŠ å¯†ã€‚å¯ä»¥é€šè¿‡strengthæ§åˆ¶åŠ å¯†å¼ºåº¦,é»˜è®¤ä¸º10ã€‚</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Test
public void test01(){
    //åˆ›å»ºå¯†ç è§£æå™¨
    BCryptPasswordEncoder bCryptPasswordEncoder=new BCryptPasswrodEncoder();
    //å¯¹å¯†ç è¿›è¡ŒåŠ å¯†
    String password=bCryptPasswordEncoder.encode("123456");
    //æ‰“å°åŠ å¯†åçš„æ•°æ®
    System.out.println("åŠ å¯†ä¹‹åçš„æ•°æ®:"+password);
    //åˆ¤æ–­åŸå­—ç¬¦åŠ å¯†åå’ŒåŠ å¯†ä¹‹å‰æ˜¯å¦åŒ¹é…
    boolean result=bCryptPasswordEncoder.matches("123456",password);
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-ç”¨æˆ·è®¤è¯"><a href="#4-ç”¨æˆ·è®¤è¯" class="headerlink" title="4. ç”¨æˆ·è®¤è¯"></a>4. ç”¨æˆ·è®¤è¯</h3><ol><li><p>è®¾ç½®ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç </p><ul><li><p>ç¬¬ä¸€ç§æ–¹å¼ : é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®</p><pre class="line-numbers language-lang-properties"><code class="language-lang-properties">spring.security.user.name=rikc
spring.security.user.password=123456
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>ç¬¬äºŒç§æ–¹å¼ :é€šè¿‡é…ç½®ç±»</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">package com.wisedu.securitydemo1.config;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        BCryptPasswordEncoder bCryptPasswordEncoder=new BCryptPasswordEncoder();
        String password=bCryptPasswordEncoder.encode("123456");
        auth.inMemoryAuthentication().withUser("rikc").password(password).roles("admin");
    }
    @Bean
    public PasswordEncoder password(){
        return new BCryptPasswordEncoder();
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç¬¬ä¸‰ç§æ–¹å¼ : è‡ªå®šä¹‰ç¼–å†™å®ç°ç±»</p><p>Â· ç¬¬ä¸€æ­¥ åˆ›å»ºé…ç½®ç±»,è®¾ç½®ä½¿ç”¨å“ªä¸ªuserDetailsServiceå®ç°ç±»</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Configuration
public class SecurityConfig1 extends WebSecurityConfigurerAdapter {
  @Autowired
    private UserDetailsService userDetailsService;
  @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(password());
    }
    @Bean
    public PasswordEncoder password(){
        return new BCryptPasswordEncoder();
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â· ç¬¬äºŒæ­¥ ç¼–å†™å®ç°ç±»,è¿”å›Userå¯¹è±¡,Userå¯¹è±¡æœ‰ç”¨æˆ·åå¯†ç å’Œæ“ä½œæƒé™</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Service("userDetailsService")
public class MyUserDetailsServie implements UserDetailsService {
    @Override
    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {
        List<grantedauthority> auths= AuthorityUtils.commaSeparatedStringToAuthorityList("role");
        return new User("rikc",new BCryptPasswordEncoder().encode("123"),auths);
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></grantedauthority></code></pre></li></ul></li><li><p>æŸ¥è¯¢æ•°æ®åº“å®Œæˆè®¤è¯</p><p>è¿™æ˜¯åŸºäº(1)é‡Œé¢çš„ç¬¬ä¸‰ç§è‡ªå®šä¹‰ç¼–å†™å®ç°ç±»é€šè¿‡æŸ¥è¯¢æ•°æ®åº“å®Œæˆè®¤è¯æ“ä½œ</p><p>ğŸ“• å¯¼å…¥ç›¸å…³ä¾èµ–</p><pre class="line-numbers language-lang-xml"><code class="language-lang-xml"><dependency>
    <groupid>com.baomidou</groupid>
 <artifactid>mybatis-plus-boot-starter</artifactid>
    <version>3.0.5</version>
</dependency>
<dependency>
    <groupid>mysql</groupid>
    <artifactid>mysql-connection-java</artifactid>
</dependency>
<dependecy>
    <groupid>org.projectlombok</groupid>
    <artifactid>lombok</artifactid>
</dependecy>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ“• åˆ¶ä½œå®ä½“ç±»</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Data
public class User{
    private Integer id;
    private String username;
    private String password
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ“• æ•´åˆmapper,åˆ›å»ºæ¥å£ï¼Œæ“ä½œæ•°æ®åº“æŸ¥è¯¢</p></li></ol><h3 id="5-è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢"><a href="#5-è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢" class="headerlink" title="5. è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢"></a>5. è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢</h3><ol><li><p>é…ç½®ç±»ä¸­å®ç°ç›¸å…³çš„é…ç½®</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Configuration
public class SecurityConfig1 extends WebSecurityConfigurerAdapter {
    @Autowired
    private UserDetailsService userDetailsService;
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(password());
    }
    @Bean
    public PasswordEncoder password(){
        return new BCryptPasswordEncoder();
    }
    /**
    *è‡ªå®šä¹‰ç™»å½•é¡µé¢    
    */
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin()    //è‡ªå®šä¹‰ç¼–å†™ç™»å½•é¡µé¢
            .loginPage("/login.html")   //ç™»å½•é¡µé¢è®¾ç½®
            .loginProcessingUrl("/user/login")     //ç™»å½•è®¿é—®Controllerè·¯å¾„
            .defaultSuccessUrl("/test/index").permitAll()   //ç™»é™†æˆåŠŸä»¥å,è·³è½¬è·¯å¾„
            .and().authorizeRequests()
                .antMatchers("/","/test/hello","/user/login").permitAll()//è®¾ç½®å“ªäº›è·¯å¾„å¯ä»¥ç›´æ¥è®¿é—®ä¸éœ€è¦ç™»å½•è®¤è¯
            .anyRequest().authenticated()
                .and().csrf().disable();//å…³é—­csrfé˜²æŠ¤
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="6-ç”¨æˆ·æˆæƒ-åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶"><a href="#6-ç”¨æˆ·æˆæƒ-åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶" class="headerlink" title="6. ç”¨æˆ·æˆæƒ(åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶)"></a>6. ç”¨æˆ·æˆæƒ(åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶)</h3><h4 id="6-1-hasAuthority-æ–¹æ³•"><a href="#6-1-hasAuthority-æ–¹æ³•" class="headerlink" title="6.1 hasAuthority æ–¹æ³•"></a>6.1 hasAuthority æ–¹æ³•</h4><p>å¦‚æœå½“å‰çš„ä¸»ä½“å…·æœ‰æŒ‡å®šçš„æƒé™,åˆ™è¿”å›true,å¦åˆ™è¿”å›false</p><ul><li><p>åœ¨é…ç½®ç±»ä¸­è®¾ç½®å½“å‰è®¿é—®åœ°å€æœ‰å“ªäº›æƒé™</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">//å½“å‰ç™»å½•ç”¨æˆ·åªæœ‰å…·æœ‰adminsæƒé™æ‰å¯ä»¥è®¿é—®è¿™ä¸ªè·¯å¾„
.antMatchers("/test/index").hasAuthority("admin")
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>åœ¨UserDetailsService,æŠŠè¿”å›çš„Userå¯¹è±¡è®¾ç½®æƒé™</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">Users users=userMapper.selectOne("");
//è®¾ç½®ç”¨æˆ·æƒé™ä¸ºç®¡ç†å‘˜æƒé™
List<grantedauthority> auths=AuthorityUtils.commaSeparatedStringToAuthorityList("admin");
UserDetailsSerivce userDetail=new User(users.getUserName,new BCryptPasswordEncoder().encode(users.getPassword()),auths);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></grantedauthority></code></pre></li></ul><h4 id="6-2-hasAnyAuthority-æ–¹æ³•"><a href="#6-2-hasAnyAuthority-æ–¹æ³•" class="headerlink" title="6.2 hasAnyAuthority æ–¹æ³•"></a>6.2 hasAnyAuthority æ–¹æ³•</h4><p>å¦‚æœå½“å‰çš„ä¸»ä½“æœ‰ä»»ä½•æä¾›çš„è§’è‰²(ç»™å®šçš„ä½œä¸ºä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨)çš„è¯,è¿”å›true</p><pre><code>.anyMatchers(&quot;/test/index&quot;).hasAnyAuthority(&quot;admin,manager&quot;)
</code></pre><h4 id="6-3-hasRole-æ–¹æ³•"><a href="#6-3-hasRole-æ–¹æ³•" class="headerlink" title="6.3 hasRole æ–¹æ³•"></a>6.3 hasRole æ–¹æ³•</h4><p>å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šè§’è‰²å°±å…è®¸è®¿é—®,å¦åˆ™å‡ºç°403</p><p>å¦‚æœå½“å‰ä¸»ä½“å…·æœ‰æŒ‡å®šçš„è§’è‰²,åˆ™è¿”å›true</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">.antMatchers("/test/index").hasRole("role")
//æºç ä¸­è¿›è¡Œäº†å°è£…, éœ€è¦æ·»åŠ ROLE_ã€‚
//æºç     
return "hasRole('ROLE_"+role+"')";
List<grantedauthority> auths=AuthorityUtils.commaSeparatedStringToAuthorityList("admin,ROLE_role");
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></grantedauthority></code></pre><p>æ³¨æ„ : é…ç½®æ–‡ä»¶ä¸­ä¸éœ€è¦æ·»åŠ â€ROLE_â€,å› ä¸ºä¸Šè¿°çš„åº•å±‚æºç ä¼šè‡ªåŠ¨æ·»åŠ ä¸ä¹‹è¿›è¡ŒåŒ¹é…ã€‚</p><h4 id="6-4-hasAnyRole-æ–¹æ³•"><a href="#6-4-hasAnyRole-æ–¹æ³•" class="headerlink" title="6.4 hasAnyRole æ–¹æ³•"></a>6.4 hasAnyRole æ–¹æ³•</h4><p>è¡¨ç¤ºç”¨æˆ·å…·å¤‡ä»»ä½•ä¸€ä¸ªæ¡ä»¶éƒ½å¯ä»¥è®¿é—®ã€‚</p><p>ç»™ç”¨æˆ·æ·»åŠ è§’è‰²:</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">//ç”¨æˆ·å¯¹è±¡ä¸ä¸ºç©ºè¿”å›å½“å‰ç”¨æˆ·
return new User(username,user.getPassword(),AuthorityUtils.commaSeparatedStringToAuthorityList("admin,role,ROLE_admin,ROLE_role"));
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ :</p><pre><code>.antMatchers(&quot;/test/admin&quot;).hasAnyRole(&quot;role&quot;)
</code></pre><h3 id="7-ç”¨æˆ·æˆæƒ-è‡ªå®šä¹‰403é¡µé¢"><a href="#7-ç”¨æˆ·æˆæƒ-è‡ªå®šä¹‰403é¡µé¢" class="headerlink" title="7. ç”¨æˆ·æˆæƒ(è‡ªå®šä¹‰403é¡µé¢)"></a>7. ç”¨æˆ·æˆæƒ(è‡ªå®šä¹‰403é¡µé¢)</h3><p>åœ¨é…ç½®ç±»é‡Œé¢è¿›è¡Œé…ç½®å³å¯ã€‚</p><pre><code>http.execptionHandling().accessDeniedPage(&quot;/unauth&quot;);
</code></pre><h3 id="8-ç”¨æˆ·æˆæƒ-æ³¨è§£ä½¿ç”¨"><a href="#8-ç”¨æˆ·æˆæƒ-æ³¨è§£ä½¿ç”¨" class="headerlink" title="8. ç”¨æˆ·æˆæƒ(æ³¨è§£ä½¿ç”¨)"></a>8. ç”¨æˆ·æˆæƒ(æ³¨è§£ä½¿ç”¨)</h3><h4 id="8-1-Secured"><a href="#8-1-Secured" class="headerlink" title="8.1 @Secured"></a>8.1 <a href="https://github.com/Secured" target="_blank" rel="noopener">@Secured</a></h4><p>åˆ¤æ–­æ˜¯å¦å…·æœ‰è§’è‰²,å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡ŒåŒ¹é…çš„å­—ç¬¦ä¸²éœ€è¦æ·»åŠ å‰ç¼€â€ROLE_â€ã€‚</p><p>ä½¿ç”¨æ³¨è§£è¦æå‰å¼€å¯æ³¨è§£åŠŸèƒ½ã€‚</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@SpringBootApplication
@EnableGlobalMethodSecurity(securedEnabled=true)
public class DemosecurityApplication{
    public static void main(String[] args){
        SpringApplication.run(DemosecurityApplication.class,args);
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ·»åŠ Controller</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("testSecured")
@ResponseBody
@Secured({"ROLE_normal","ROLE_admin"})
public String helloUser(){
    return "hello,user";
}
@Secured({"ROLE_normal","Role_ç®¡ç†å‘˜"})
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8-2-PreAuthorize"><a href="#8-2-PreAuthorize" class="headerlink" title="8.2 @PreAuthorize"></a>8.2 <a href="https://github.com/PreAuthorize" target="_blank" rel="noopener">@PreAuthorize</a></h4><p>å…ˆå¼€å¯æ³¨è§£åŠŸèƒ½</p><p><a href="https://github.com/EnableGlobalMethodSecurity" target="_blank" rel="noopener">@EnableGlobalMethodSecurity</a>(prePostEnabled=true)</p><p><a href="https://github.com/PreAuthorize" target="_blank" rel="noopener">@PreAuthorize</a> : æ³¨è§£é€‚åˆè¿›å…¥æ–¹æ³•å‰çš„æƒé™éªŒè¯,<a href="https://github.com/PreAuthorize" target="_blank" rel="noopener">@PreAuthorize</a> å¯ä»¥å°†ç™»å½•ç”¨æˆ·çš„roles/permissionså‚æ•°ä¼ å…¥åˆ°æ–¹æ³•ä¸­ã€‚</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("/preAuthorize")
@ResponseBody
@PreAuthorize("hasAnyAuthority('menu:system')")
public String preAuthorize(){
    System.out.println("preAuthorize");
    return "preAuthorize";
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8-3-PostAuthorize"><a href="#8-3-PostAuthorize" class="headerlink" title="8.3 @PostAuthorize"></a>8.3 <a href="https://github.com/PostAuthorize" target="_blank" rel="noopener">@PostAuthorize</a></h4><p>å…ˆå¼€å¯æ³¨è§£åŠŸèƒ½:</p><p><a href="https://github.com/EnableGlobalMethodSecurity" target="_blank" rel="noopener">@EnableGlobalMethodSecurity</a>(prePostEnabled=true)</p><p><a href="https://github.com/PostAuthorize" target="_blank" rel="noopener">@PostAuthorize</a> æ³¨è§£ä½¿ç”¨å¹¶ä¸å¤š,åœ¨æ–¹æ³•æ‰§è¡Œåå†è¿›è¡Œæƒé™éªŒè¯ï¼Œé€‚åˆéªŒè¯å¸¦æœ‰è¿”å›å€¼çš„æƒé™</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("/testPostAuthorize")
@ResponseBody
@PostAuthorzie("hasAnyAuthorize('menu:system')")
public String preAuthorize(){
    System.out.println("test-PostAuthorize");
    return "PostAuthorize";
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8-4-PostFilter"><a href="#8-4-PostFilter" class="headerlink" title="8.4 @PostFilter"></a>8.4 <a href="https://github.com/PostFilter" target="_blank" rel="noopener">@PostFilter</a></h4><p><a href="https://github.com/PostFilter" target="_blank" rel="noopener">@PostFilter</a> : æƒé™éªŒè¯ä¹‹åå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤,ç•™ä¸‹ç”¨æˆ·åæ˜¯admin1çš„æ•°æ®</p><p>è¡¨è¾¾å¼ä¸­çš„filterObjectå¼•ç”¨çš„æ˜¯æ–¹æ³•è¿”å›å€¼Listä¸­çš„æŸä¸€ä¸ªå…ƒç´ </p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("getAll")
@PreAuthorize("hasRole('ROLE_ç®¡ç†å‘˜')")
@PostFilter("filterObject.username=='admin1'")
@ResponseBody
public List<userinfo> getAllUser(){
    ArrayList<userinfo> list=new ArrayList<>();
    list.add(new UserInfo(1l,"admin1","6666"));
    list.add(new UserInfo(2l,"admin2","6666"));
    return list;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></userinfo></userinfo></code></pre><h4 id="8-5-PreFilter"><a href="#8-5-PreFilter" class="headerlink" title="8.5 @PreFilter"></a>8.5 <a href="https://github.com/PreFilter" target="_blank" rel="noopener">@PreFilter</a></h4><p><a href="https://github.com/PreFilter" target="_blank" rel="noopener">@PreFilter</a> : è¿›å…¥æ§åˆ¶å™¨ä¹‹å‰å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("getTestPreFilter")
@PreAuthorize("hasRole('ROLE_ç®¡ç†å‘˜')")
@PreFilter(value="filterObject.id%2==0")
@ResonseBody
public List<userinfo> getTestPreFilter(@RequestBody List<userinfo> list){
    list.forEach(t->{
        System.out.println(t.getId()+"\t"+t.getUsername());
    });
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></userinfo></userinfo></code></pre><h3 id="9-ç”¨æˆ·æ³¨é”€"><a href="#9-ç”¨æˆ·æ³¨é”€" class="headerlink" title="9. ç”¨æˆ·æ³¨é”€"></a>9. ç”¨æˆ·æ³¨é”€</h3><p>åœ¨é…ç½®ç±»ä¸­æ·»åŠ é€€å‡ºæ˜ å°„åœ°å€</p><pre><code>http.logout().logoutUrl(&quot;/logout&quot;).logoutSuccessUrl(&quot;/index&quot;).permitAll();
</code></pre><h3 id="10-è‡ªåŠ¨ç™»å½•"><a href="#10-è‡ªåŠ¨ç™»å½•" class="headerlink" title="10. è‡ªåŠ¨ç™»å½•"></a>10. è‡ªåŠ¨ç™»å½•</h3><p><img src="/img/loading.gif" data-lazy-src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoverikcLoveimage-20210210005345863.png" alt="image-20210210005345863"></p><p><img src="/img/loading.gif" data-lazy-src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoverikcLoveimage-20210210005636400.png" alt="image-20210210005636400"></p><p>ç¬¬ä¸€æ­¥ : åˆ›å»ºæ•°æ®åº“è¡¨</p><pre class="line-numbers language-lang-sql"><code class="language-lang-sql">CREATE TABLE `persisent_logins`(
    `username` varchar(64) NOT NULL,
    `series` varchar(64) NOT NULL,
    `token` varchar(64) NOT NULL,
    `last_used` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY(`series`)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒæ­¥ : é…ç½®ç±»,æ³¨å…¥æ•°æ®æº,é…ç½®æ“ä½œæ•°æ®åº“å¯¹è±¡</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Autowired
private DataSource dataSource;
@Bean
public PersistentTokenRepository persistentTokenRespository(){
    JdbcTokenRepositoryImpl jdbcTokenRepositoryImpl = new JdbcTokenRepositoryImpl();
    jdbcTokenRepositoryImpl.setDataSource(dataSource);
    //è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨
    //jdbcTokenRepositoryImpl.setCreateTableOnStartup(true);
    return jdbcTokenRepositoryImpl;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-lang-java"><code class="language-lang-java">.and().rememberMe().tokenRespository(persistentTokenRepository())
    .tokenValiditySeconds(60)//è®¾ç½®æœ‰æ•ˆæ—¶é•¿å•ä½æ˜¯ç§’
    .userDetailsService(userDetailsService)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸‰æ­¥ : é¡µé¢æ·»åŠ è®°ä½æˆ‘å¤é€‰æ¡†</p><pre><code>è®°ä½æˆ‘ :&lt;input type=&quot;checkbox&quot; name=&quot;remember-me&quot; title=&quot;è®°ä½å¯†ç &quot;/&gt;&lt;br/&gt;
æ­¤å¤„ : name å±æ€§å¿…é¡»ä¸º remember-me,ä¸èƒ½æ”¹ä¸ºå…¶ä»–å€¼
</code></pre><h3 id="11-CSRFåŠŸèƒ½"><a href="#11-CSRFåŠŸèƒ½" class="headerlink" title="11. CSRFåŠŸèƒ½"></a>11. CSRFåŠŸèƒ½</h3><p>è·¨åŸŸè¯·æ±‚ä¼ªé€ (è‹±è¯­ : Cross-site request forgery),ä¹Ÿè¢«ç§°ä¸ºone-clickattackæˆ–è€…session riding,é€šå¸¸ç¼©å†™ä¸ºCSRFæˆ–è€…XSRF,æ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚è·Ÿè·¨ç½‘ç«™è„šæœ¬(XSS)ç›¸æ¯”,XSSåˆ©ç”¨çš„æ˜¯ç”¨æˆ·å¯¹æŒ‡å®šç½‘ç«™çš„ä¿¡ä»»ï¼ŒCSRFåˆ©ç”¨çš„æ˜¯ç½‘ç«™å¯¹ç”¨æˆ·ç½‘é¡µæµè§ˆå™¨çš„ä¿¡ä»»ã€‚</p><p>è·¨åŸŸè¯·æ±‚æ”»å‡»ï¼Œç®€å•çš„è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œ(å¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“)ã€‚ç”±äºæµè§ˆå™¨æ›¾ç»è®¤è¯è¿‡ï¼Œæ‰€ä»¥è¢«è®¿é—®çš„ç½‘ç«™ä¼šè®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·æ“ä½œè€Œå»è¿è¡Œã€‚è¿™åˆ©ç”¨äº†Webä¸­ç”¨æˆ·èº«ä»½éªŒè¯çš„ä¸€ä¸ªæ¼æ´ : <strong>==ç®€å•çš„èº«ä»½éªŒè¯åªèƒ½ä¿è¯è¯·æ±‚å‘è‡ªæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨,å´ä¸èƒ½ä¿è¯è¯·æ±‚æœ¬èº«æ˜¯ç”¨æˆ·è‡ªæ„¿å‘å‡ºçš„ã€‚==</strong></p><p>ä»Spring Security 4.0 å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå¼€å¯CSRFä¿æŠ¤ï¼Œä»¥é˜²æ­¢CSRFæ”»å‡»åº”ç”¨ç¨‹åºï¼ŒSpring Security CSRF ä¼šé’ˆå¯¹PATCH,POST,PUTå’ŒDELETEæ–¹æ³•è¿›è¡Œé˜²æŠ¤ã€‚</p><p>Spring Security å®ç°CSRFçš„åŸç† :</p><ul><li>ç”ŸæˆcsrfTokenä¿å­˜åˆ°HttpSessionæˆ–è€…Cookieä¸­.</li></ul><p>æ¡ˆä¾‹ :</p><p>åœ¨ç™»å½•é¡µé¢æ·»åŠ ä¸€ä¸ªéšè—åŸŸ :</p><pre><code>&lt;input type=&quot;hidden&quot; th:if=&quot;${_csrf}!=null&quot; th:value=&quot;${_csrf.token}&quot; name=&quot;_csrf&quot;/&gt;
</code></pre><p>å…³é—­å®‰å…¨é…ç½®çš„ç±»ä¸­çš„csrf :</p><pre><code>//http.csrf().disable();
</code></pre><p>æ·»åŠ ä¾èµ–</p><pre class="line-numbers language-lang-xml"><code class="language-lang-xml">
<dependency>
    <groupid>org.thymeleaf.extras</groupid>
    <artifactid>thymeleaf-extras-springsecurity5</artifactid>
</dependency>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:undefined">Kayleh</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://kayleh.top/SpringSecurity/">https://kayleh.top/SpringSecurity/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="https://kayleh.top" target="_blank">Kayleh</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f41058e8051f381" async></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> æ‰“èµ<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/wechatpay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/wechatpay.jpg" alt="wechat"></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" data-lazy-src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/alipay.jpg" alt="alipay"></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div></div><div class="post-ad"><ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7457165067653912" data-ad-slot="9837525717" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/spring-and-jwt/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/indexbg.jpg" onerror='onerror=null,src="/img/404.jpg"'><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Spring and Jwt</div></div></a></div><div class="next-post pull-right"><a href="/improve-robustness-(2)/"><img class="next-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/kayleh/cdn/img/index2.jpg" onerror='onerror=null,src="/img/404.jpg"'><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Improve Robustness (2)</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" style="background-image:url(https://cdn.jsdelivr.net/gh/kayleh/cdn/img/index4.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Kayleh</div><div class="footer_custom_text">all rights reserved.</div></div><div style="text-align:center"><a href="https://info.flagcounter.com/cDh1" target="_blank" rel="noopener"><img src="https://s11.flagcounter.com/count/cDh1/bg_49B1F5/txt_000000/border_49B1F5/columns_4/maxflags_16/viewers_0/labels_1/pageviews_0/flags_0/percent_1/" alt="Flag Counter" border="0"></a></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="font_plus" type="button" title="æ”¾å¤§å­—ä½“"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="ç¼©å°å­—ä½“"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: 'FgNaybmwy1yu74JH4lXMgH5S-gzGzoHsz',
      appKey: 'OBHyEdMVsi8FSFA0aqJNh4HE',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: true,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful=!0,POWERMODE.shake=!0,document.body.addEventListener("input",POWERMODE)</script><script src="/js/third-party/click_heart.js" async></script><script>!function(t,e,o,c,n,i,a){t.DaoVoiceObject=n,t[n]=t[n]||function(){(t[n].q=t[n].q||[]).push(arguments)},t[n].l=+new Date,i=e.createElement(o),a=e.getElementsByTagName(o)[0],i.async=1,i.src=c,i.charset="utf-8",a.parentNode.insertBefore(i,a)}(window,document,"script",("https:"==document.location.protocol?"https:":"http:")+"//widget.daovoice.io/widget/38b1c911.js","daovoice")</script><script>var isChatBtn = false
daovoice('init', {
  app_id: '38b1c911',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // æ‚¬æµ® ICON æ˜¯å¦æ˜¾ç¤º
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // æ‚¬æµ® ICON æ˜¯å¦æ˜¾ç¤º
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // æ‚¬æµ® ICON æ˜¯å¦æ˜¾ç¤º
        },
      });
    }
  }
}</script></div><script src="/live2d-widget/autoload.js"></script></body></html>