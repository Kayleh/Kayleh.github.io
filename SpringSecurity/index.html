<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Kayleh"><title>SpringSecurity Â· Kayleh</title><meta name="description" content="SpringBootæ•´åˆSpringSecurity
https://www.kuangstudy.com/bbs/1369251751735095298

Spring Securityè¯¾ç¨‹ä»‹ç»1. æ¡†æ¶æ¦‚è¿°ğŸ“• Spring Securityæ˜¯åŸºäºSpringæ¡†æ¶,æä¾›äº†ä¸€å¥—Webåº”ç”¨å®‰å…¨æ€§çš„å®Œ"><meta name="keywords" content=""><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/bootstrap.min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style-dark.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="stage" class="container"><div class="row"><div id="side-bar" class="col-sm-3 col-xs-12 side-container invisible"><div class="vertical-text site-title"><h3 tabindex="-1" class="site-title-small"><a href="/" class="a-title">Kayleh</a></h3><h1 tabindex="-1" class="site-title-large"><a href="/" class="a-title">æ´»ç‰ˆå°å­—</a></h1></div><br class="visible-lg visible-md visible-sm"><div id="site-nav" class="site-title-links"><ul><li><a href="/">Home</a></li><li><a href="/archives">Archive</a></li><li><a href="/categories">Categories</a></li><li><a href="/tags">Tags</a></li><li><a href="/google8102e2f35ce9e391.html"></a></li><li><a href="/mainfest.json"></a></li><li><a href="/categories/categories.html"></a></li><li><a href="/about/index.html">about</a></li><li><a href="/link/index.html">å‹äººå¸</a></li><li class="soc"><a href="https://github.com/kayleh" target="_blank" rel="noopener noreferrer"><i class="fa fa-github">&nbsp;</i></a><a href="https://twitter.com/kayleh" target="_blank" rel="noopener noreferrer"><i class="fa fa-twitter">&nbsp;</i></a><a href="https://www.instagram.com/kayleh" target="_blank" rel="noopener noreferrer"><i class="fa fa-instagram">&nbsp;</i></a><a href="https://kayleh.top/atom.xml" target="_blank" rel="noopener noreferrer"><i class="fa fa-rss">&nbsp;</i></a></li></ul><div class="visible-lg visible-md visible-sm site-nav-footer"><br class="site-nav-footer-br"><footer><p>&copy;&nbsp;2021&nbsp;<a target="_blank" href="https://kayleh.top" rel="noopener noreferrer">Kayleh</a></p><span>visitors:<span id="busuanzi_value_site_pv"></span></span></footer></div></div></div><div id="main-container" class="col-sm-9 col-xs-12 main-container invisible"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post-container"><p class="post-title"><a>SpringSecurity</a></p><p class="post-meta"><span class="date meta-item">Posted at&nbsp;2021-05-21</span><span class="meta-item"><i class="fa fa-comment-o"></i><span>&nbsp;</span><a href="/SpringSecurity/#comments">Comments</a></span></p><p class="post-abstract"></p><h1 id="SpringBootæ•´åˆSpringSecurity"><a href="#SpringBootæ•´åˆSpringSecurity" class="headerlink" title="SpringBootæ•´åˆSpringSecurity"></a>SpringBootæ•´åˆSpringSecurity</h1><blockquote><p><a href="https://www.kuangstudy.com/bbs/1369251751735095298" target="_blank" rel="noopener">https://www.kuangstudy.com/bbs/1369251751735095298</a></p></blockquote><h2 id="Spring-Securityè¯¾ç¨‹ä»‹ç»"><a href="#Spring-Securityè¯¾ç¨‹ä»‹ç»" class="headerlink" title="Spring Securityè¯¾ç¨‹ä»‹ç»"></a>Spring Securityè¯¾ç¨‹ä»‹ç»</h2><h3 id="1-æ¡†æ¶æ¦‚è¿°"><a href="#1-æ¡†æ¶æ¦‚è¿°" class="headerlink" title="1. æ¡†æ¶æ¦‚è¿°"></a>1. æ¡†æ¶æ¦‚è¿°</h3><p>ğŸ“• Spring Securityæ˜¯åŸºäºSpringæ¡†æ¶,æä¾›äº†ä¸€å¥—Webåº”ç”¨å®‰å…¨æ€§çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æ­£å¦‚ä½ å¯èƒ½çŸ¥é“çš„å…³äºå®‰å…¨æ–¹é¢çš„ä¸¤ä¸ªä¸»è¦åŒºåŸŸæ˜¯â€è®¤è¯â€å’Œâ€æˆæƒâ€(æˆ–è€…è®¿é—®æ§åˆ¶),ä¸€èˆ¬æ¥è¯´ï¼ŒWebåº”ç”¨çš„å®‰å…¨æ€§ä¸»è¦åŒ…æ‹¬ç”¨æˆ·è®¤è¯å’Œç”¨æˆ·æˆæƒä¸¤ä¸ªéƒ¨åˆ†,è¿™ä¸¤ç‚¹ä¹Ÿæ˜¯Spring Securityçš„é‡è¦æ ¸å¿ƒåŠŸèƒ½ã€‚</p><ol><li>ç”¨æˆ·è®¤è¯æŒ‡çš„æ˜¯ : éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦ä¸ºç³»ç»Ÿä¸­çš„åˆæ³•ä¸»ä½“,ä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·èƒ½å¦è®¿é—®è¯¥ç³»ç»Ÿã€‚ç”¨æˆ·è®¤è¯ä¸€èˆ¬è¦æ±‚ç”¨æˆ·æä¾›ç”¨æˆ·åå’Œå¯†ç ã€‚ç³»ç»Ÿé€šè¿‡æ ¡éªŒç”¨æˆ·åå’Œå¯†ç æ¥å®Œæˆè®¤è¯è¿‡ç¨‹ã€‚<strong>==é€šä¿—ç‚¹è¯´å°±æ˜¯ç³»ç»Ÿè®¤ä¸ºç”¨æˆ·æ˜¯å¦èƒ½ç™»å½•ã€‚==</strong></li><li>ç”¨æˆ·æˆæƒæŒ‡çš„æ˜¯ : éªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æœ‰æƒé™æ‰§è¡ŒæŸä¸ªæ“ä½œã€‚åœ¨åŒä¸€ç³»ç»Ÿä¸­ï¼Œä¸åŒç”¨æˆ·æ‰€å…·æœ‰çš„æƒé™æ˜¯ä¸åŒçš„ã€‚æ¯”å¦‚å¯¹ä¸€ä¸ªæ–‡ä»¶æ¥è¯´ï¼Œæœ‰çš„ç”¨æˆ·åªèƒ½è¿›è¡Œè¯»å–ï¼Œè€Œæœ‰çš„ç”¨æˆ·å¯ä»¥ä¿®æ”¹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç³»ç»Ÿä¼šä¸ºä¸åŒçš„ç”¨æˆ·åˆ†é…ä¸åŒçš„è§’è‰²ï¼Œè€Œæ¯ä¸ªè§’è‰²å¯¹åº”ä¸€ç³»åˆ—çš„æƒé™ã€‚<strong>==é€šä¿—ç‚¹å°±æ˜¯ç³»ç»Ÿåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å»åšæŸäº›äº‹æƒ…ã€‚==</strong></li></ol><p>ğŸ“• Spring Security ç‰¹ç‚¹ :</p><ul><li>å’ŒSpringæ— ç¼æ•´åˆã€‚</li><li>å…¨é¢çš„æƒé™æ§åˆ¶</li><li>ä¸“é—¨ä¸ºWebå¼€å‘è€Œè®¾è®¡<ul><li>æ—§ç‰ˆæœ¬ä¸èƒ½è„±ç¦»Webç¯å¢ƒä½¿ç”¨</li><li>æ–°ç‰ˆæœ¬å¯¹æ•´ä¸ªæ¡†æ¶è¿›è¡Œäº†åˆ†å±‚æŠ½å–ï¼Œåˆ†æˆäº†æ ¸å¿ƒæ¨¡å—å’ŒWebæ¨¡å—,å•ç‹¬å¼•å…¥æ ¸å¿ƒæ¨¡å—å°±å¯ä»¥è„±ç¦»Webç¯å¢ƒã€‚</li></ul></li><li>é‡é‡çº§ã€‚</li></ul><h3 id="2-å…¥é—¨æ¡ˆä¾‹"><a href="#2-å…¥é—¨æ¡ˆä¾‹" class="headerlink" title="2. å…¥é—¨æ¡ˆä¾‹"></a>2. å…¥é—¨æ¡ˆä¾‹</h3><ol><li><p>åˆ›å»ºSpringBootå·¥ç¨‹,å¼•å…¥ç›¸å…³ä¾èµ–</p><pre class="line-numbers language-lang-xml"><code class="language-lang-xml"><parent>
        <groupid>org.springframework.boot</groupid>
        <artifactid>spring-boot-starter-parent</artifactid>
        <version>2.2.1.RELEASE</version>
        <relativepath>
    </parent>
    <dependencies>
        
        <dependency>
            <groupid>org.springframework.boot</groupid>
            <artifactid>spring-boot-starter-web</artifactid>
        </dependency>
        
        <dependency>
            <groupid>org.springframework.boot</groupid>
            <artifactid>spring-boot-starter-security</artifactid>
        </dependency>
    </dependencies>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç¼–å†™Controllerè¿›è¡Œæµ‹è¯•</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RestController
public class TestController {
    @GetMapping("/add")
    public String add() {
        return "hello Security";
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="3-SpringSecurityåŸºæœ¬åŸç†"><a href="#3-SpringSecurityåŸºæœ¬åŸç†" class="headerlink" title="3. SpringSecurityåŸºæœ¬åŸç†"></a>3. SpringSecurityåŸºæœ¬åŸç†</h3><p>ğŸŒ³ <strong>Spring Security æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨é“¾</strong></p><ul><li>FilterSecurityInterceptor : æ˜¯ä¸€ä¸ªæ–¹æ³•çº§çš„æƒé™è¿‡æ»¤å™¨,åŸºæœ¬ä½äºè¿‡æ»¤é“¾çš„æœ€åº•éƒ¨</li><li>ExceptionTranslationFilter : æ˜¯ä¸€ä¸ªå¼‚å¸¸è¿‡æ»¤å™¨,ç”¨æ¥å¤„ç†åœ¨è®¤è¯æˆæƒè¿‡ç¨‹ä¸­æŠ›å‡ºçš„å¼‚å¸¸</li><li>UsernamePassowrdAuthenticationFilter : å¯¹/loginçš„postè¯·æ±‚åšæ‹¦æˆª,æ ¡éªŒè¡¨å•ä¸­ç”¨æˆ·åå’Œå¯†ç ã€‚</li></ul><p>ğŸŒ³ è¿‡æ»¤å™¨æ˜¯å¦‚ä½•è¿›è¡ŒåŠ è½½çš„ï¼Ÿ</p><p><img src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoverikcLoveimage-20210206021008467.png" alt="image-20210206021008467"></p><p>ğŸŒ³ ä¸¤ä¸ªé‡è¦çš„æ¥å£</p><p>âšª UserDetailsServiceæ¥å£è¯¦è§£</p><p>å½“ä»€ä¹ˆä¹Ÿæ²¡æœ‰é…ç½®çš„æ—¶å€™,è´¦å·å’Œå¯†ç æ˜¯ç”±SpringSecurityå®šä¹‰ç”Ÿæˆçš„ã€‚è€Œåœ¨å®é™…é¡¹ç›®ä¸­è´¦å·å’Œå¯†ç éƒ½æ˜¯ä»æ•°æ®åº“ä¸­æŸ¥å‡ºæ¥çš„,æ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡è‡ªå®šä¹‰é€»è¾‘æ§åˆ¶è®¤è¯é€»è¾‘ã€‚<strong>==é€šä¿—ç‚¹æ¥è¯´å°±æ˜¯æŸ¥è¯¢ç”¨æˆ·åå’Œå¯†ç çš„è¿‡ç¨‹==</strong> å¦‚éœ€è¦è‡ªå®šä¹‰é€»è¾‘æ—¶,åªéœ€è¦å®ç°UserDetailsServiceæ¥å£å³å¯ï¼Œæ¥å£å®šä¹‰å¦‚ä¸‹ :</p><p><img src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoveimage-20210206022109352.png" alt="image-20210206022109352"></p><p>è¿”å›å€¼ UserDetails</p><p>è¿™ä¸ªç±»æ˜¯ç³»ç»Ÿé»˜è®¤çš„ç”¨æˆ·ä¸»ä½“</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">// è¡¨ç¤ºè·å–ç™»å½•ç”¨æˆ·çš„æ‰€æœ‰æƒé™
Collection<? extends GrantedAuthority> getAuthorities();
// è¡¨ç¤ºè·å–å¯†ç 
String getPassword();
// è¡¨ç¤ºè·å–ç”¨æˆ·å
String getUsername();
// è¡¨ç¤ºåˆ¤æ–­ç”¨æˆ·æ˜¯å¦è¢«é”å®š
boolean isAccountNonLocked();
// è¡¨ç¤ºå‡­è¯{å¯†ç }æ˜¯å¦è¿‡æœŸ
boolean isCredentialsNonExpired();
// è¡¨ç¤ºå½“å‰ç”¨æˆ·åæ˜¯å¦å¯ç”¨
boolean isEnabled();
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoverikcLoveimage-20210206023136065.png" alt="image-20210206023135919"></p><p>âšª PasswordEncoder æ¥å£è®²è§£</p><p>æ•°æ®åŠ å¯†çš„æ¥å£,ç”¨äºè¿”å›Userå¯¹è±¡é‡Œé¢å¯†ç åŠ å¯†</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">// è¡¨ç¤ºæŠŠå‚æ•°æŒ‰ç…§ç‰¹å®šçš„è§£æè§„åˆ™è¿›è¡Œè§£æ
String encode(CharSequence rawPassword);
// è¡¨ç¤ºéªŒè¯ä»å­˜å‚¨ä¸­è·å–çš„ç¼–ç å¯†ç ä¸ç¼–ç åæäº¤çš„åŸå§‹å¯†ç æ˜¯å¦åŒ¹é…ã€‚å¦‚æœå¯†ç åŒ¹é…,åˆ™è¿”å›true;å¦‚æœä¸åŒ¹é…,åˆ™è¿”å›falseã€‚ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºéœ€è¦è¢«è§£æçš„å¯†ç ã€‚ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå­˜å‚¨çš„å¯†ç ã€‚
boolean matches(CharSequence rawPassowrd,String encodePassword);
// è¡¨ç¤ºå¦‚æœè§£æçš„å¯†ç èƒ½å¤Ÿå†æ¬¡è¿›è¡Œè§£æä¸”è¾¾åˆ°æ›´å®‰å…¨çš„ç»“æœåˆ™è¿”å›true,å¦åˆ™è¿”å›falseã€‚é»˜è®¤è¿”å›false
default boolean upgradeEncoding(String encodePassowrd);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>âšª BCryptPasswordEncoder</p><p>BCryptPasswordEncoderæ˜¯Spring Securityå®˜æ–¹æ¨èçš„å¯†ç è§£æå™¨,å¹³æ—¶å¤šä½¿ç”¨è¿™ä¸ªè§£æå™¨</p><p>BCryptPasswordEncoderæ˜¯å¯¹bcryptå¼ºæ•£åˆ—æ–¹æ³•çš„å…·ä½“å®ç°ã€‚æ˜¯åŸºäºHashç®—æ³•å®ç°çš„å•å‘åŠ å¯†ã€‚å¯ä»¥é€šè¿‡strengthæ§åˆ¶åŠ å¯†å¼ºåº¦,é»˜è®¤ä¸º10ã€‚</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Test
public void test01(){
    //åˆ›å»ºå¯†ç è§£æå™¨
    BCryptPasswordEncoder bCryptPasswordEncoder=new BCryptPasswrodEncoder();
    //å¯¹å¯†ç è¿›è¡ŒåŠ å¯†
    String password=bCryptPasswordEncoder.encode("123456");
    //æ‰“å°åŠ å¯†åçš„æ•°æ®
    System.out.println("åŠ å¯†ä¹‹åçš„æ•°æ®:"+password);
    //åˆ¤æ–­åŸå­—ç¬¦åŠ å¯†åå’ŒåŠ å¯†ä¹‹å‰æ˜¯å¦åŒ¹é…
    boolean result=bCryptPasswordEncoder.matches("123456",password);
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-ç”¨æˆ·è®¤è¯"><a href="#4-ç”¨æˆ·è®¤è¯" class="headerlink" title="4. ç”¨æˆ·è®¤è¯"></a>4. ç”¨æˆ·è®¤è¯</h3><ol><li><p>è®¾ç½®ç™»å½•çš„ç”¨æˆ·åå’Œå¯†ç </p><ul><li><p>ç¬¬ä¸€ç§æ–¹å¼ : é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®</p><pre class="line-numbers language-lang-properties"><code class="language-lang-properties">spring.security.user.name=rikc
spring.security.user.password=123456
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>ç¬¬äºŒç§æ–¹å¼ :é€šè¿‡é…ç½®ç±»</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">package com.wisedu.securitydemo1.config;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfiguration;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        BCryptPasswordEncoder bCryptPasswordEncoder=new BCryptPasswordEncoder();
        String password=bCryptPasswordEncoder.encode("123456");
        auth.inMemoryAuthentication().withUser("rikc").password(password).roles("admin");
    }
    @Bean
    public PasswordEncoder password(){
        return new BCryptPasswordEncoder();
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç¬¬ä¸‰ç§æ–¹å¼ : è‡ªå®šä¹‰ç¼–å†™å®ç°ç±»</p><p>Â· ç¬¬ä¸€æ­¥ åˆ›å»ºé…ç½®ç±»,è®¾ç½®ä½¿ç”¨å“ªä¸ªuserDetailsServiceå®ç°ç±»</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Configuration
public class SecurityConfig1 extends WebSecurityConfigurerAdapter {
  @Autowired
    private UserDetailsService userDetailsService;
  @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(password());
    }
    @Bean
    public PasswordEncoder password(){
        return new BCryptPasswordEncoder();
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Â· ç¬¬äºŒæ­¥ ç¼–å†™å®ç°ç±»,è¿”å›Userå¯¹è±¡,Userå¯¹è±¡æœ‰ç”¨æˆ·åå¯†ç å’Œæ“ä½œæƒé™</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Service("userDetailsService")
public class MyUserDetailsServie implements UserDetailsService {
    @Override
    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {
        List<grantedauthority> auths= AuthorityUtils.commaSeparatedStringToAuthorityList("role");
        return new User("rikc",new BCryptPasswordEncoder().encode("123"),auths);
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></grantedauthority></code></pre></li></ul></li><li><p>æŸ¥è¯¢æ•°æ®åº“å®Œæˆè®¤è¯</p><p>è¿™æ˜¯åŸºäº(1)é‡Œé¢çš„ç¬¬ä¸‰ç§è‡ªå®šä¹‰ç¼–å†™å®ç°ç±»é€šè¿‡æŸ¥è¯¢æ•°æ®åº“å®Œæˆè®¤è¯æ“ä½œ</p><p>ğŸ“• å¯¼å…¥ç›¸å…³ä¾èµ–</p><pre class="line-numbers language-lang-xml"><code class="language-lang-xml"><dependency>
    <groupid>com.baomidou</groupid>
 <artifactid>mybatis-plus-boot-starter</artifactid>
    <version>3.0.5</version>
</dependency>
<dependency>
    <groupid>mysql</groupid>
    <artifactid>mysql-connection-java</artifactid>
</dependency>
<dependecy>
    <groupid>org.projectlombok</groupid>
    <artifactid>lombok</artifactid>
</dependecy>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ“• åˆ¶ä½œå®ä½“ç±»</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Data
public class User{
    private Integer id;
    private String username;
    private String password
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ğŸ“• æ•´åˆmapper,åˆ›å»ºæ¥å£ï¼Œæ“ä½œæ•°æ®åº“æŸ¥è¯¢</p></li></ol><h3 id="5-è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢"><a href="#5-è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢" class="headerlink" title="5. è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢"></a>5. è‡ªå®šä¹‰ç”¨æˆ·ç™»å½•ç•Œé¢</h3><ol><li><p>é…ç½®ç±»ä¸­å®ç°ç›¸å…³çš„é…ç½®</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Configuration
public class SecurityConfig1 extends WebSecurityConfigurerAdapter {
    @Autowired
    private UserDetailsService userDetailsService;
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(password());
    }
    @Bean
    public PasswordEncoder password(){
        return new BCryptPasswordEncoder();
    }
    /**
    *è‡ªå®šä¹‰ç™»å½•é¡µé¢    
    */
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin()    //è‡ªå®šä¹‰ç¼–å†™ç™»å½•é¡µé¢
            .loginPage("/login.html")   //ç™»å½•é¡µé¢è®¾ç½®
            .loginProcessingUrl("/user/login")     //ç™»å½•è®¿é—®Controllerè·¯å¾„
            .defaultSuccessUrl("/test/index").permitAll()   //ç™»é™†æˆåŠŸä»¥å,è·³è½¬è·¯å¾„
            .and().authorizeRequests()
                .antMatchers("/","/test/hello","/user/login").permitAll()//è®¾ç½®å“ªäº›è·¯å¾„å¯ä»¥ç›´æ¥è®¿é—®ä¸éœ€è¦ç™»å½•è®¤è¯
            .anyRequest().authenticated()
                .and().csrf().disable();//å…³é—­csrfé˜²æŠ¤
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="6-ç”¨æˆ·æˆæƒ-åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶"><a href="#6-ç”¨æˆ·æˆæƒ-åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶" class="headerlink" title="6. ç”¨æˆ·æˆæƒ(åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶)"></a>6. ç”¨æˆ·æˆæƒ(åŸºäºè§’è‰²æˆ–æƒé™è¿›è¡Œè®¿é—®æ§åˆ¶)</h3><h4 id="6-1-hasAuthority-æ–¹æ³•"><a href="#6-1-hasAuthority-æ–¹æ³•" class="headerlink" title="6.1 hasAuthority æ–¹æ³•"></a>6.1 hasAuthority æ–¹æ³•</h4><p>å¦‚æœå½“å‰çš„ä¸»ä½“å…·æœ‰æŒ‡å®šçš„æƒé™,åˆ™è¿”å›true,å¦åˆ™è¿”å›false</p><ul><li><p>åœ¨é…ç½®ç±»ä¸­è®¾ç½®å½“å‰è®¿é—®åœ°å€æœ‰å“ªäº›æƒé™</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">//å½“å‰ç™»å½•ç”¨æˆ·åªæœ‰å…·æœ‰adminsæƒé™æ‰å¯ä»¥è®¿é—®è¿™ä¸ªè·¯å¾„
.antMatchers("/test/index").hasAuthority("admin")
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>åœ¨UserDetailsService,æŠŠè¿”å›çš„Userå¯¹è±¡è®¾ç½®æƒé™</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">Users users=userMapper.selectOne("");
//è®¾ç½®ç”¨æˆ·æƒé™ä¸ºç®¡ç†å‘˜æƒé™
List<grantedauthority> auths=AuthorityUtils.commaSeparatedStringToAuthorityList("admin");
UserDetailsSerivce userDetail=new User(users.getUserName,new BCryptPasswordEncoder().encode(users.getPassword()),auths);
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></grantedauthority></code></pre></li></ul><h4 id="6-2-hasAnyAuthority-æ–¹æ³•"><a href="#6-2-hasAnyAuthority-æ–¹æ³•" class="headerlink" title="6.2 hasAnyAuthority æ–¹æ³•"></a>6.2 hasAnyAuthority æ–¹æ³•</h4><p>å¦‚æœå½“å‰çš„ä¸»ä½“æœ‰ä»»ä½•æä¾›çš„è§’è‰²(ç»™å®šçš„ä½œä¸ºä¸€ä¸ªé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²åˆ—è¡¨)çš„è¯,è¿”å›true</p><pre><code>.anyMatchers(&quot;/test/index&quot;).hasAnyAuthority(&quot;admin,manager&quot;)
</code></pre><h4 id="6-3-hasRole-æ–¹æ³•"><a href="#6-3-hasRole-æ–¹æ³•" class="headerlink" title="6.3 hasRole æ–¹æ³•"></a>6.3 hasRole æ–¹æ³•</h4><p>å¦‚æœç”¨æˆ·å…·å¤‡ç»™å®šè§’è‰²å°±å…è®¸è®¿é—®,å¦åˆ™å‡ºç°403</p><p>å¦‚æœå½“å‰ä¸»ä½“å…·æœ‰æŒ‡å®šçš„è§’è‰²,åˆ™è¿”å›true</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">.antMatchers("/test/index").hasRole("role")
//æºç ä¸­è¿›è¡Œäº†å°è£…, éœ€è¦æ·»åŠ ROLE_ã€‚
//æºç     
return "hasRole('ROLE_"+role+"')";
List<grantedauthority> auths=AuthorityUtils.commaSeparatedStringToAuthorityList("admin,ROLE_role");
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></grantedauthority></code></pre><p>æ³¨æ„ : é…ç½®æ–‡ä»¶ä¸­ä¸éœ€è¦æ·»åŠ â€ROLE_â€,å› ä¸ºä¸Šè¿°çš„åº•å±‚æºç ä¼šè‡ªåŠ¨æ·»åŠ ä¸ä¹‹è¿›è¡ŒåŒ¹é…ã€‚</p><h4 id="6-4-hasAnyRole-æ–¹æ³•"><a href="#6-4-hasAnyRole-æ–¹æ³•" class="headerlink" title="6.4 hasAnyRole æ–¹æ³•"></a>6.4 hasAnyRole æ–¹æ³•</h4><p>è¡¨ç¤ºç”¨æˆ·å…·å¤‡ä»»ä½•ä¸€ä¸ªæ¡ä»¶éƒ½å¯ä»¥è®¿é—®ã€‚</p><p>ç»™ç”¨æˆ·æ·»åŠ è§’è‰²:</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">//ç”¨æˆ·å¯¹è±¡ä¸ä¸ºç©ºè¿”å›å½“å‰ç”¨æˆ·
return new User(username,user.getPassword(),AuthorityUtils.commaSeparatedStringToAuthorityList("admin,role,ROLE_admin,ROLE_role"));
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ :</p><pre><code>.antMatchers(&quot;/test/admin&quot;).hasAnyRole(&quot;role&quot;)
</code></pre><h3 id="7-ç”¨æˆ·æˆæƒ-è‡ªå®šä¹‰403é¡µé¢"><a href="#7-ç”¨æˆ·æˆæƒ-è‡ªå®šä¹‰403é¡µé¢" class="headerlink" title="7. ç”¨æˆ·æˆæƒ(è‡ªå®šä¹‰403é¡µé¢)"></a>7. ç”¨æˆ·æˆæƒ(è‡ªå®šä¹‰403é¡µé¢)</h3><p>åœ¨é…ç½®ç±»é‡Œé¢è¿›è¡Œé…ç½®å³å¯ã€‚</p><pre><code>http.execptionHandling().accessDeniedPage(&quot;/unauth&quot;);
</code></pre><h3 id="8-ç”¨æˆ·æˆæƒ-æ³¨è§£ä½¿ç”¨"><a href="#8-ç”¨æˆ·æˆæƒ-æ³¨è§£ä½¿ç”¨" class="headerlink" title="8. ç”¨æˆ·æˆæƒ(æ³¨è§£ä½¿ç”¨)"></a>8. ç”¨æˆ·æˆæƒ(æ³¨è§£ä½¿ç”¨)</h3><h4 id="8-1-Secured"><a href="#8-1-Secured" class="headerlink" title="8.1 @Secured"></a>8.1 <a href="https://github.com/Secured" target="_blank" rel="noopener">@Secured</a></h4><p>åˆ¤æ–­æ˜¯å¦å…·æœ‰è§’è‰²,å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡ŒåŒ¹é…çš„å­—ç¬¦ä¸²éœ€è¦æ·»åŠ å‰ç¼€â€ROLE_â€ã€‚</p><p>ä½¿ç”¨æ³¨è§£è¦æå‰å¼€å¯æ³¨è§£åŠŸèƒ½ã€‚</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@SpringBootApplication
@EnableGlobalMethodSecurity(securedEnabled=true)
public class DemosecurityApplication{
    public static void main(String[] args){
        SpringApplication.run(DemosecurityApplication.class,args);
    }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ§åˆ¶å™¨æ–¹æ³•ä¸Šæ·»åŠ Controller</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("testSecured")
@ResponseBody
@Secured({"ROLE_normal","ROLE_admin"})
public String helloUser(){
    return "hello,user";
}
@Secured({"ROLE_normal","Role_ç®¡ç†å‘˜"})
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8-2-PreAuthorize"><a href="#8-2-PreAuthorize" class="headerlink" title="8.2 @PreAuthorize"></a>8.2 <a href="https://github.com/PreAuthorize" target="_blank" rel="noopener">@PreAuthorize</a></h4><p>å…ˆå¼€å¯æ³¨è§£åŠŸèƒ½</p><p><a href="https://github.com/EnableGlobalMethodSecurity" target="_blank" rel="noopener">@EnableGlobalMethodSecurity</a>(prePostEnabled=true)</p><p><a href="https://github.com/PreAuthorize" target="_blank" rel="noopener">@PreAuthorize</a> : æ³¨è§£é€‚åˆè¿›å…¥æ–¹æ³•å‰çš„æƒé™éªŒè¯,<a href="https://github.com/PreAuthorize" target="_blank" rel="noopener">@PreAuthorize</a> å¯ä»¥å°†ç™»å½•ç”¨æˆ·çš„roles/permissionså‚æ•°ä¼ å…¥åˆ°æ–¹æ³•ä¸­ã€‚</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("/preAuthorize")
@ResponseBody
@PreAuthorize("hasAnyAuthority('menu:system')")
public String preAuthorize(){
    System.out.println("preAuthorize");
    return "preAuthorize";
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8-3-PostAuthorize"><a href="#8-3-PostAuthorize" class="headerlink" title="8.3 @PostAuthorize"></a>8.3 <a href="https://github.com/PostAuthorize" target="_blank" rel="noopener">@PostAuthorize</a></h4><p>å…ˆå¼€å¯æ³¨è§£åŠŸèƒ½:</p><p><a href="https://github.com/EnableGlobalMethodSecurity" target="_blank" rel="noopener">@EnableGlobalMethodSecurity</a>(prePostEnabled=true)</p><p><a href="https://github.com/PostAuthorize" target="_blank" rel="noopener">@PostAuthorize</a> æ³¨è§£ä½¿ç”¨å¹¶ä¸å¤š,åœ¨æ–¹æ³•æ‰§è¡Œåå†è¿›è¡Œæƒé™éªŒè¯ï¼Œé€‚åˆéªŒè¯å¸¦æœ‰è¿”å›å€¼çš„æƒé™</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("/testPostAuthorize")
@ResponseBody
@PostAuthorzie("hasAnyAuthorize('menu:system')")
public String preAuthorize(){
    System.out.println("test-PostAuthorize");
    return "PostAuthorize";
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="8-4-PostFilter"><a href="#8-4-PostFilter" class="headerlink" title="8.4 @PostFilter"></a>8.4 <a href="https://github.com/PostFilter" target="_blank" rel="noopener">@PostFilter</a></h4><p><a href="https://github.com/PostFilter" target="_blank" rel="noopener">@PostFilter</a> : æƒé™éªŒè¯ä¹‹åå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤,ç•™ä¸‹ç”¨æˆ·åæ˜¯admin1çš„æ•°æ®</p><p>è¡¨è¾¾å¼ä¸­çš„filterObjectå¼•ç”¨çš„æ˜¯æ–¹æ³•è¿”å›å€¼Listä¸­çš„æŸä¸€ä¸ªå…ƒç´ </p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("getAll")
@PreAuthorize("hasRole('ROLE_ç®¡ç†å‘˜')")
@PostFilter("filterObject.username=='admin1'")
@ResponseBody
public List<userinfo> getAllUser(){
    ArrayList<userinfo> list=new ArrayList<>();
    list.add(new UserInfo(1l,"admin1","6666"));
    list.add(new UserInfo(2l,"admin2","6666"));
    return list;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></userinfo></userinfo></code></pre><h4 id="8-5-PreFilter"><a href="#8-5-PreFilter" class="headerlink" title="8.5 @PreFilter"></a>8.5 <a href="https://github.com/PreFilter" target="_blank" rel="noopener">@PreFilter</a></h4><p><a href="https://github.com/PreFilter" target="_blank" rel="noopener">@PreFilter</a> : è¿›å…¥æ§åˆ¶å™¨ä¹‹å‰å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@RequestMapping("getTestPreFilter")
@PreAuthorize("hasRole('ROLE_ç®¡ç†å‘˜')")
@PreFilter(value="filterObject.id%2==0")
@ResonseBody
public List<userinfo> getTestPreFilter(@RequestBody List<userinfo> list){
    list.forEach(t->{
        System.out.println(t.getId()+"\t"+t.getUsername());
    });
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></userinfo></userinfo></code></pre><h3 id="9-ç”¨æˆ·æ³¨é”€"><a href="#9-ç”¨æˆ·æ³¨é”€" class="headerlink" title="9. ç”¨æˆ·æ³¨é”€"></a>9. ç”¨æˆ·æ³¨é”€</h3><p>åœ¨é…ç½®ç±»ä¸­æ·»åŠ é€€å‡ºæ˜ å°„åœ°å€</p><pre><code>http.logout().logoutUrl(&quot;/logout&quot;).logoutSuccessUrl(&quot;/index&quot;).permitAll();
</code></pre><h3 id="10-è‡ªåŠ¨ç™»å½•"><a href="#10-è‡ªåŠ¨ç™»å½•" class="headerlink" title="10. è‡ªåŠ¨ç™»å½•"></a>10. è‡ªåŠ¨ç™»å½•</h3><p><img src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoverikcLoveimage-20210210005345863.png" alt="image-20210210005345863"></p><p><img src="/SpringSecurity/Hugo\hugo_0.75.1_Windows-64bit\blog\content\posts\SpringSecurity\rikcLoverikcLoveimage-20210210005636400.png" alt="image-20210210005636400"></p><p>ç¬¬ä¸€æ­¥ : åˆ›å»ºæ•°æ®åº“è¡¨</p><pre class="line-numbers language-lang-sql"><code class="language-lang-sql">CREATE TABLE `persisent_logins`(
    `username` varchar(64) NOT NULL,
    `series` varchar(64) NOT NULL,
    `token` varchar(64) NOT NULL,
    `last_used` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY(`series`)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¬¬äºŒæ­¥ : é…ç½®ç±»,æ³¨å…¥æ•°æ®æº,é…ç½®æ“ä½œæ•°æ®åº“å¯¹è±¡</p><pre class="line-numbers language-lang-java"><code class="language-lang-java">@Autowired
private DataSource dataSource;
@Bean
public PersistentTokenRepository persistentTokenRespository(){
    JdbcTokenRepositoryImpl jdbcTokenRepositoryImpl = new JdbcTokenRepositoryImpl();
    jdbcTokenRepositoryImpl.setDataSource(dataSource);
    //è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨
    //jdbcTokenRepositoryImpl.setCreateTableOnStartup(true);
    return jdbcTokenRepositoryImpl;
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-lang-java"><code class="language-lang-java">.and().rememberMe().tokenRespository(persistentTokenRepository())
    .tokenValiditySeconds(60)//è®¾ç½®æœ‰æ•ˆæ—¶é•¿å•ä½æ˜¯ç§’
    .userDetailsService(userDetailsService)
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ç¬¬ä¸‰æ­¥ : é¡µé¢æ·»åŠ è®°ä½æˆ‘å¤é€‰æ¡†</p><pre><code>è®°ä½æˆ‘ :&lt;input type=&quot;checkbox&quot; name=&quot;remember-me&quot; title=&quot;è®°ä½å¯†ç &quot;/&gt;&lt;br/&gt;
æ­¤å¤„ : name å±æ€§å¿…é¡»ä¸º remember-me,ä¸èƒ½æ”¹ä¸ºå…¶ä»–å€¼
</code></pre><h3 id="11-CSRFåŠŸèƒ½"><a href="#11-CSRFåŠŸèƒ½" class="headerlink" title="11. CSRFåŠŸèƒ½"></a>11. CSRFåŠŸèƒ½</h3><p>è·¨åŸŸè¯·æ±‚ä¼ªé€ (è‹±è¯­ : Cross-site request forgery),ä¹Ÿè¢«ç§°ä¸ºone-clickattackæˆ–è€…session riding,é€šå¸¸ç¼©å†™ä¸ºCSRFæˆ–è€…XSRF,æ˜¯ä¸€ç§æŒŸåˆ¶ç”¨æˆ·åœ¨å½“å‰å·²ç™»å½•çš„Webåº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œéæœ¬æ„çš„æ“ä½œçš„æ”»å‡»æ–¹æ³•ã€‚è·Ÿè·¨ç½‘ç«™è„šæœ¬(XSS)ç›¸æ¯”,XSSåˆ©ç”¨çš„æ˜¯ç”¨æˆ·å¯¹æŒ‡å®šç½‘ç«™çš„ä¿¡ä»»ï¼ŒCSRFåˆ©ç”¨çš„æ˜¯ç½‘ç«™å¯¹ç”¨æˆ·ç½‘é¡µæµè§ˆå™¨çš„ä¿¡ä»»ã€‚</p><p>è·¨åŸŸè¯·æ±‚æ”»å‡»ï¼Œç®€å•çš„è¯´ï¼Œæ˜¯æ”»å‡»è€…é€šè¿‡ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¬ºéª—ç”¨æˆ·çš„æµè§ˆå™¨å»è®¿é—®ä¸€ä¸ªè‡ªå·±æ›¾ç»è®¤è¯è¿‡çš„ç½‘ç«™å¹¶è¿è¡Œä¸€äº›æ“ä½œ(å¦‚å‘é‚®ä»¶ï¼Œå‘æ¶ˆæ¯ï¼Œç”šè‡³è´¢äº§æ“ä½œå¦‚è½¬è´¦å’Œè´­ä¹°å•†å“)ã€‚ç”±äºæµè§ˆå™¨æ›¾ç»è®¤è¯è¿‡ï¼Œæ‰€ä»¥è¢«è®¿é—®çš„ç½‘ç«™ä¼šè®¤ä¸ºæ˜¯çœŸæ­£çš„ç”¨æˆ·æ“ä½œè€Œå»è¿è¡Œã€‚è¿™åˆ©ç”¨äº†Webä¸­ç”¨æˆ·èº«ä»½éªŒè¯çš„ä¸€ä¸ªæ¼æ´ : <strong>==ç®€å•çš„èº«ä»½éªŒè¯åªèƒ½ä¿è¯è¯·æ±‚å‘è‡ªæŸä¸ªç”¨æˆ·çš„æµè§ˆå™¨,å´ä¸èƒ½ä¿è¯è¯·æ±‚æœ¬èº«æ˜¯ç”¨æˆ·è‡ªæ„¿å‘å‡ºçš„ã€‚==</strong></p><p>ä»Spring Security 4.0 å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå¼€å¯CSRFä¿æŠ¤ï¼Œä»¥é˜²æ­¢CSRFæ”»å‡»åº”ç”¨ç¨‹åºï¼ŒSpring Security CSRF ä¼šé’ˆå¯¹PATCH,POST,PUTå’ŒDELETEæ–¹æ³•è¿›è¡Œé˜²æŠ¤ã€‚</p><p>Spring Security å®ç°CSRFçš„åŸç† :</p><ul><li>ç”ŸæˆcsrfTokenä¿å­˜åˆ°HttpSessionæˆ–è€…Cookieä¸­.</li></ul><p>æ¡ˆä¾‹ :</p><p>åœ¨ç™»å½•é¡µé¢æ·»åŠ ä¸€ä¸ªéšè—åŸŸ :</p><pre><code>&lt;input type=&quot;hidden&quot; th:if=&quot;${_csrf}!=null&quot; th:value=&quot;${_csrf.token}&quot; name=&quot;_csrf&quot;/&gt;
</code></pre><p>å…³é—­å®‰å…¨é…ç½®çš„ç±»ä¸­çš„csrf :</p><pre><code>//http.csrf().disable();
</code></pre><p>æ·»åŠ ä¾èµ–</p><pre class="line-numbers language-lang-xml"><code class="language-lang-xml">
<dependency>
    <groupid>org.thymeleaf.extras</groupid>
    <artifactid>thymeleaf-extras-springsecurity5</artifactid>
</dependency>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p></p></div><div class="share"><span>Share</span>&nbsp;<span class="soc"><a href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank" class="fa fa-bookmark"></a></span><span class="soc"><a href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));" class="fa fa-weibo"></a></span><span class="soc"><a href="http://twitter.com/home?status=https://kayleh.top/SpringSecurity/%20Kayleh%20SpringSecurity" target="_blank" rel="noopener" class="fa fa-twitter"></a></span></div><div class="pagination"><p class="clearfix"><span class="pre pagbuttons"><a role="navigation" href="/spring-and-jwt/" title="Spring and Jwt"><i class="fa fa-angle-double-left"></i>&nbsp;Previous post: Spring and Jwt</a></span><span>&nbsp;</span><span class="next pagbuttons"><a role="navigation" href="/improve-robustness-(2)/" title="Improve Robustness (2)">Next post: Improve Robustness (2)&nbsp;<i class="fa fa-angle-double-right"></i></a></span></p></div><a id="comments"></a><div id="disqus_thread"></div><script>var disqus_shortname="kayleh",disqus_identifier="SpringSecurity/",disqus_title="SpringSecurity",disqus_url="https://kayleh.top/SpringSecurity/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script id="dsq-count-scr" src="//kayleh.disqus.com/count.js" async></script></div></div></div><div class="visible-xs site-bottom-footer"><footer><p>&copy;&nbsp;2021&nbsp;<a target="_blank" href="https://kayleh.top" rel="noopener noreferrer">Kayleh</a></p><span>visitors:<span id="busuanzi_value_site_pv"></span></span></footer></div></div></div></div><script src="/js/jquery-3.1.0.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/google-analytics.js"></script><script src="/js/typography.js"></script><script src="/js/dao.js"></script><script src="https://cdn.jsdelivr.net/gh/kayleh/cdn2/busuanzi/busuanzi.pure.mini.js"></script><script data-ad-client="ca-pub-7457165067653912" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script></body></html>